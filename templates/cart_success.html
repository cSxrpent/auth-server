<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Purchase Successful - RXZBot Shop</title>
    <style>
        :root{--bg:#0a0e1a;--card:#0f1724;--accent:#00d4ff;--success:#2ed573;--danger:#ff4757;--muted:#9aa4b2}*{box-sizing:border-box;margin:0;padding:0}body{font-family:'Segoe UI',system-ui,Arial;background:linear-gradient(135deg,#071026,#0d1526,#1a1f35);color:#eaf1ff;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}.container{background:linear-gradient(135deg,rgba(255,255,255,0.05),rgba(255,255,255,0.02));border-radius:20px;padding:50px;max-width:700px;width:100%;border:2px solid rgba(0,212,255,0.3);box-shadow:0 20px 80px rgba(0,0,0,0.9);text-align:center}.success-icon{font-size:5rem;margin-bottom:20px;animation:bounce 1s ease}@keyframes bounce{0%,20%,50%,80%,100%{transform:translateY(0)}40%{transform:translateY(-30px)}60%{transform:translateY(-15px)}}h1{font-size:2.5rem;background:linear-gradient(90deg,var(--success),#20bf55);background-clip:text;-webkit-background-clip:text;color:transparent;margin-bottom:15px}.subtitle{color:var(--muted);font-size:1.2rem;margin-bottom:40px}.summary-box{background:rgba(0,0,0,0.3);border-radius:15px;padding:25px;margin-bottom:30px;border:1px solid rgba(255,255,255,0.1)}.summary-row{display:flex;justify-content:space-between;padding:12px 0;color:var(--muted)}.summary-row strong{color:#fff}.items-list{max-height:300px;overflow-y:auto;margin:20px 0;text-align:left}.item-row{background:rgba(255,255,255,0.03);border-radius:10px;padding:15px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center;border:1px solid rgba(255,255,255,0.1)}.item-name{color:#fff;font-weight:600}.item-status{display:flex;align-items:center;gap:8px}.status-icon{font-size:1.3rem}.success-status{color:var(--success)}.error-status{color:var(--danger)}.stats-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:20px;margin:30px 0}.stat-card{background:linear-gradient(135deg,rgba(0,212,255,0.1),rgba(123,75,255,0.05));border-radius:12px;padding:20px;border:1px solid rgba(0,212,255,0.3)}.stat-value{font-size:2.5rem;font-weight:700;background:linear-gradient(90deg,var(--accent),#7b4bff);background-clip:text;-webkit-background-clip:text;color:transparent}.stat-label{color:var(--muted);font-size:0.95rem;margin-top:5px}.warning-box{background:rgba(255,71,87,0.1);border:2px dashed rgba(255,71,87,0.3);border-radius:12px;padding:20px;margin:20px 0;color:var(--danger)}.button{background:linear-gradient(90deg,var(--accent),#7b4bff);color:#fff;padding:15px 40px;border-radius:12px;text-decoration:none;font-weight:700;font-size:1.1rem;display:inline-block;margin-top:30px;transition:all 0.3s;border:none;cursor:pointer}.button:hover{transform:scale(1.05);box-shadow:0 8px 30px rgba(0,212,255,0.5)}@media(max-width:768px){.container{padding:30px 20px}h1{font-size:2rem}.stats-grid{grid-template-columns:1fr}}
    </style>
</head>
<body>
    <div class="container">
        <div class="success-icon">üéâ</div>
        <h1>Purchase Successful!</h1>
        <p class="subtitle">Your purchase has been completed for <strong>{{ username }}</strong></p>
        
        {% set has_gift_cards = cart | selectattr('category', 'equalto', 'gift_card') | list | length > 0 %}
        {% set has_real_items = cart | rejectattr('category', 'equalto', 'gift_card') | list | length > 0 %}
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value">{{ successful }}</div>
                <div class="stat-label">Items Delivered</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ total }}</div>
                <div class="stat-label">Total Items</div>
            </div>
        </div>
        
        {% if successful < total and has_real_items %}
        <div class="warning-box">
            <strong>‚ö†Ô∏è Partial Delivery</strong><br>
            Some items couldn't be delivered. Please contact support.
        </div>
        {% endif %}
        
        <div class="summary-box">
            <h3 style="margin-bottom:20px;color:#fff">üì¶ Order Details</h3>
            
            <div class="items-list">
                {% for item in cart %}
                    {% if item.category == 'gift_card' %}
                    <div class="item-row">
                        <div class="item-name">{{ item.name }}</div>
                        <div class="item-status">
                            <span class="status-icon success-status">üéÅ</span>
                            <span class="success-status">Gift Card Ready</span>
                        </div>
                    </div>
                    {% if gift_codes %}
                        {% for gc in gift_codes %}
                            {% if gc.item == item.name %}
                            <div style="margin:8px 0;padding:8px;border-radius:8px;background:rgba(0,0,0,0.15);color:var(--muted);">Code: <strong style="color:#fff">{{ gc.code }}</strong> (‚Ç¨{{ "%.2f"|format(gc.amount) }})</div>
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                    {% else %}
                    {% set item_results = results | selectattr('item', 'equalto', item.name) | list %}
                    {% for i in range(item.quantity) %}
                    <div class="item-row">
                        <div class="item-name">{{ item.name }}</div>
                        <div class="item-status">
                            {% if item_results and item_results[loop.index0] and item_results[loop.index0].success %}
                            <span class="status-icon success-status">‚úì</span>
                            <span class="success-status">Delivered</span>
                            {% else %}
                            <span class="status-icon error-status">‚úó</span>
                            <span class="error-status">Failed</span>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                    {% endif %}
                {% endfor %}
            </div>
            
            <div class="summary-row" style="border-top:2px solid rgba(255,255,255,0.1);padding-top:15px;margin-top:15px">
                <strong>Status:</strong>
                <strong style="color:{{ 'var(--success)' if (successful == total or (has_gift_cards and not has_real_items)) else 'var(--danger)' }}">
                    {% if has_gift_cards and not has_real_items %}
                    ‚úÖ Ready to Use
                    {% else %}
                    {{ successful }}/{{ total }} delivered
                    {% endif %}
                </strong>
            </div>
        </div>
        
        {% if has_real_items %}
        <div style="background:rgba(0,212,255,0.1);border-radius:12px;padding:20px;margin:25px 0;border:1px solid rgba(0,212,255,0.3)">
            <strong style="color:var(--accent)">‚ÑπÔ∏è Important</strong><br>
            <span style="color:var(--muted);font-size:0.95rem">
                Gifts were sent with 2-second delays. Check your Wolvesville account!
            </span>
        </div>
        {% endif %}
        
        {% if has_gift_cards %}
        <div style="background:rgba(46,213,115,0.1);border-radius:12px;padding:20px;margin:25px 0;border:1px solid rgba(46,213,115,0.3)">
            <strong style="color:var(--success)">üéÅ Gift Card Ready</strong><br>
            <span style="color:var(--muted);font-size:0.95rem">
                Your gift card code is ready to use. You'll receive it via email or can view it in your account dashboard.
            </span>
        </div>
        {% endif %}
        
        <a href="/shop" class="button">‚Üê Back to Shop</a>
    </div>
</body>
</html>