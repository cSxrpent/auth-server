<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - RXZBot</title>
    <style>
        :root{
            --bg:#0a0e1a; --card:#0f1724; --muted:#9aa4b2; --accent:#00d4ff; --danger:#ff4757; --glass: rgba(255,255,255,0.02); --success:#2ed573;
            --radius:16px; --glow:0 0 20px rgba(0,212,255,0.3); --gold:#ffd700;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', system-ui, Arial;
            background: linear-gradient(135deg,#071026,#0d1526,#1a1f35);
            color: #eaf1ff;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Particles */
        .particles{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0}
        .particle{position:absolute;background:var(--accent);border-radius:50%;opacity:0.1;animation:float 10s infinite linear}
        @keyframes float{from{transform:translateY(100vh) rotate(0deg)}to{transform:translateY(-100px) rotate(360deg)}}
        
        .header {
            background: linear-gradient(135deg,var(--card),rgba(15,23,36,0.9));
            color: white;
            padding: 25px 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            border-bottom: 1px solid rgba(0,212,255,0.2);
            position: relative;
            z-index: 10;
        }
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .welcome {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(90deg,var(--accent),#7b4bff);
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
        }
        .logout-btn {
            background: linear-gradient(90deg,var(--danger),#ee5a6f);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            text-decoration: none;
            transition: all 0.3s;
            font-weight: 600;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        .logout-btn::before{
            content:'';
            position:absolute;
            top:50%;
            left:50%;
            width:0;
            height:0;
            border-radius:50%;
            background:rgba(255,255,255,0.2);
            transition:width 0.6s,height 0.6s,top 0.6s,left 0.6s;
            pointer-events:none;
        }
        .logout-btn:hover::before{
            width:300px;
            height:300px;
            top:-150px;
            left:-150px;
        }
        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255,71,87,0.4);
        }
        .container {
            max-width: 1400px;
            margin: 30px auto;
            display: flex;
            gap: 25px;
            padding: 0 20px;
            position: relative;
            z-index: 1;
        }
        .sidebar {
            width: 280px;
            background: linear-gradient(135deg,var(--card),rgba(15,23,36,0.8));
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.7);
            border: 1px solid rgba(255,255,255,0.05);
            height: fit-content;
            position: sticky;
            top: 20px;
        }
        .sidebar-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 2px solid var(--accent);
            padding-bottom: 12px;
        }
        .account-item {
            padding: 15px;
            margin-bottom: 12px;
            background: linear-gradient(135deg,rgba(255,255,255,0.05),rgba(255,255,255,0.02));
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            color: var(--muted);
            display: block;
            border: 2px solid rgba(255,255,255,0.05);
            font-weight: 600;
        }
        .account-item:hover {
            background: linear-gradient(135deg,rgba(0,212,255,0.1),rgba(123,75,255,0.05));
            border-color: var(--accent);
            color: #fff;
            transform: translateX(5px);
            box-shadow: 0 5px 20px rgba(0,212,255,0.2);
        }
        .account-item.active {
            background: linear-gradient(135deg,rgba(0,212,255,0.15),rgba(123,75,255,0.1));
            border-color: var(--accent);
            color: #fff;
            box-shadow: 0 0 25px rgba(0,212,255,0.3);
        }
        .add-account-btn {
            padding: 15px;
            background: linear-gradient(90deg,var(--success),#40c057);
            color: white;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: block;
            font-weight: 700;
            margin-top: 15px;
            position: relative;
            overflow: hidden;
        }
        .add-account-btn::before{
            content:'';
            position:absolute;
            top:50%;
            left:50%;
            width:0;
            height:0;
            border-radius:50%;
            background:rgba(255,255,255,0.2);
            transition:width 0.6s,height 0.6s,top 0.6s,left 0.6s;
            pointer-events:none;
        }
        .add-account-btn:hover::before{
            width:400px;
            height:400px;
            top:-200px;
            left:-200px;
        }
        .add-account-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(46,213,115,0.4);
        }
        .main-content {
            flex: 1;
            background: linear-gradient(135deg,var(--card),rgba(15,23,36,0.8));
            border-radius: var(--radius);
            padding: 35px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.7);
            border: 1px solid rgba(255,255,255,0.05);
        }
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: var(--muted);
        }
        .empty-state h2 {
            font-size: 2rem;
            margin-bottom: 15px;
            background: linear-gradient(90deg,var(--accent),#7b4bff);
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
        }
        .empty-state p {
            font-size: 1.1rem;
            opacity: 0.8;
        }
        .tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 35px;
            border-bottom: 2px solid rgba(255,255,255,0.1);
            flex-wrap: wrap;
        }
        .tab {
            padding: 15px 28px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 600;
            color: var(--muted);
            font-size: 1rem;
        }
        .tab:hover {
            color: var(--accent);
            background: rgba(0,212,255,0.05);
        }
        .tab.active {
            color: var(--accent);
            border-bottom-color: var(--accent);
            background: linear-gradient(135deg,rgba(0,212,255,0.1),rgba(123,75,255,0.05));
        }
        .tab-content {
            display: none;
            animation: fadeIn 0.4s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .tab-content.active {
            display: block;
        }
        .account-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: linear-gradient(135deg,rgba(0,212,255,0.05),rgba(123,75,255,0.02));
            border-radius: 12px;
            border: 1px solid rgba(0,212,255,0.2);
        }
        .account-username {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(90deg,var(--accent),#7b4bff);
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
            margin-bottom: 12px;
        }
        .account-level {
            font-size: 2rem;
            font-weight: 600;
            color: var(--gold);
            text-shadow: 0 0 20px rgba(255,215,0,0.3);
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .stat-card {
            background: linear-gradient(135deg,rgba(255,255,255,0.05),rgba(255,255,255,0.02));
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
            box-shadow: 0 10px 30px rgba(0,212,255,0.2);
        }
        .stat-label {
            color: var(--muted);
            font-size: 0.95rem;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(90deg,var(--accent),#7b4bff);
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
        }
        .xp-section {
            margin-top: 35px;
        }
        .xp-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 25px;
            color: var(--accent);
            border-bottom: 2px solid var(--accent);
            padding-bottom: 12px;
        }
        .license-info {
            background: linear-gradient(135deg,rgba(255,255,255,0.05),rgba(255,255,255,0.02));
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .license-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .license-status h3 {
            font-size: 1.5rem;
            color: var(--accent);
            margin-bottom: 12px;
        }
        .license-status p {
            color: var(--muted);
            font-size: 1.05rem;
            margin-top: 8px;
        }
        .license-status strong {
            color: #fff;
        }
        .license-badge {
            padding: 12px 28px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .license-badge.active {
            background: linear-gradient(90deg,var(--success),#40c057);
            color: white;
            box-shadow: 0 5px 20px rgba(46,213,115,0.3);
        }
        .license-badge.paused {
            background: linear-gradient(90deg,#ffa500,#ff8c00);
            color: white;
            box-shadow: 0 5px 20px rgba(255,165,0,0.3);
        }
        .license-actions {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s;
            font-size: 1rem;
            position: relative;
            overflow: hidden;
        }
        .btn::before{
            content:'';
            position:absolute;
            top:50%;
            left:50%;
            width:0;
            height:0;
            border-radius:50%;
            background:rgba(255,255,255,0.2);
            transition:width 0.6s,height 0.6s,top 0.6s,left 0.6s;
            pointer-events:none;
        }
        .btn:hover::before{
            width:400px;
            height:400px;
            top:-200px;
            left:-200px;
        }
        .btn-pause {
            background: linear-gradient(90deg,#ffa500,#ff8c00);
            color: white;
        }
        .btn-resume {
            background: linear-gradient(90deg,var(--success),#40c057);
            color: white;
        }
        .btn-extend {
            background: linear-gradient(90deg,var(--accent),#7b4bff);
            color: white;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,212,255,0.4);
        }
        .support-links {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .support-link {
            padding: 20px;
            background: linear-gradient(135deg,rgba(255,255,255,0.05),rgba(255,255,255,0.02));
            border-radius: 12px;
            text-decoration: none;
            color: var(--muted);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            border: 1px solid rgba(255,255,255,0.1);
            font-weight: 600;
            font-size: 1.05rem;
        }
        .support-link:hover {
            background: linear-gradient(135deg,rgba(0,212,255,0.1),rgba(123,75,255,0.05));
            border-color: var(--accent);
            color: #fff;
            transform: translateX(8px);
            box-shadow: 0 5px 25px rgba(0,212,255,0.2);
        }
        .support-link span:first-child {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .clan-info {
            background: linear-gradient(135deg,rgba(255,255,255,0.05),rgba(255,255,255,0.02));
            padding: 25px;
            border-radius: 12px;
            margin-top: 25px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .clan-info h3 {
            font-size: 1.3rem;
            color: var(--accent);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .clan-info p {
            color: var(--muted);
            font-size: 1.05rem;
            margin: 8px 0;
        }
        
        .clan-info strong {
            color: #fff;
        }
        
        /* Responsive */
        @media(max-width:968px){
            .container {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                position: static;
            }
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            }
            .account-username {
                font-size: 2rem;
            }
            .tabs {
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <div class="particles" id="particles"></div>
    
    <div class="header">
        <div class="header-content">
            <div class="welcome">‚ö° {{ email }}</div>
            <a href="/logout" class="logout-btn">Logout</a>
        </div>
    </div>

    <div class="container">
        <div class="sidebar">
            <div class="sidebar-title">üéÆ Your Accounts</div>
            <div id="accounts-list"></div>
            <a href="/add_account" class="add-account-btn">+ Add Account</a>
        </div>

        <div class="main-content">
            <div id="empty-state" class="empty-state">
                <h2>üöÄ Welcome to RXZBot Dashboard</h2>
                <p>Please choose an account from the sidebar or add a new one to get started</p>
            </div>
            <div id="account-area" style="display:none;">
            <div class="tabs">
                <div class="tab active" onclick="switchTab('main', this)">üìä Main Menu</div>
                <div class="tab" onclick="switchTab('account', this)">üë§ Account</div>
                <div class="tab" onclick="switchTab('xp', this)">‚ö° XP Tracking</div>
                <div class="tab" onclick="switchTab('license', this)">üé´ License</div>
                <div class="tab" onclick="switchTab('support', this)">üí¨ Support</div>
            </div>

            <div id="main-tab" class="tab-content active">
                <div class="account-header">
                    <div id="account-username" class="account-username">&nbsp;</div>
                    <div id="account-level" class="account-level">‚≠ê Level N/A</div>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">üÜî Player ID</div>
                        <div id="player-id" class="stat-value" style="font-size: 1rem;">N/A</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">üíé Total XP</div>
                        <div id="xp-total" class="stat-value">N/A</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">üìà XP Until Next Level</div>
                        <div id="xp-until" class="stat-value">N/A</div>
                    </div>
                </div>
            </div>

            <div id="account-tab" class="tab-content">
                <div class="account-header">
                    <div id="account-username-2" class="account-username">&nbsp;</div>
                    <div id="account-level-2" class="account-level">‚≠ê Level N/A</div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">üèÜ Games Won</div>
                        <div id="games-won" class="stat-value">N/A</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">üíÄ Games Lost</div>
                        <div id="games-lost" class="stat-value">N/A</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">üìä Win Ratio</div>
                        <div class="stat-value"><span id="win-ratio">N/A</span></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">üë• Friends Count</div>
                        <div id="friends-count" class="stat-value">N/A</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">üéÆ Total Games</div>
                        <div id="total-games" class="stat-value">N/A</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">‚öîÔ∏è Ranked Games</div>
                        <div id="ranked-skill" class="stat-value">N/A</div>
                    </div>
                </div>
                
                <div id="clan-info-container" style="display:none;">
                <div class="clan-info">
                    <h3>üõ°Ô∏è Clan Information</h3>
                </div>
                <div id="clan-none" class="clan-info" style="display:none;">
                    <h3>üõ°Ô∏è Clan Information</h3>
                    <p style="text-align: center; color: var(--muted);">Not in a clan</p>
                </div>
                </div>
            </div>

            <div id="xp-tab" class="tab-content">
                <div class="account-header">
                    <div id="account-username-3" class="account-username">&nbsp;</div>
                    <div id="account-level-3" class="account-level">‚≠ê Level N/A</div>
                </div>
                
                <div class="xp-section">
                    <div class="xp-title">ü§ñ Bot XP Statistics</div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">üìÖ XP Gained Today</div>
                            <div class="stat-value"><span id="xp-daily">0</span></div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">üìä XP Gained This Week</div>
                            <div class="stat-value"><span id="xp-weekly">0</span></div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">üìà XP Gained This Month</div>
                            <div class="stat-value"><span id="xp-monthly">0</span></div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">üèÜ Total Bot XP</div>
                            <div class="stat-value"><span id="xp-total-display">0</span></div>
                        </div>
                        <div class="stat-card" style="grid-column: span 2;">
                            <div class="stat-label">‚≠ê Levels Gained by Bot</div>
                            <div class="stat-value" style="font-size: 3rem;" id="levels-gained">0</div>
                            <div style="color: var(--muted); font-size: 0.9rem; margin-top: 10px;">
                                (<span id="xp-total-dup">0</span> XP √∑ 2000 per level)
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="license-tab" class="tab-content">
                <div class="license-info">
                    <div class="license-status">
                        <div>
                            <h3>üé´ License Status</h3>
                            <p id="license-message" style="margin-top:10px; color:var(--muted);">Loading...</p>
                            <p id="license-details" style="margin-top:5px; color:var(--muted);"></p>
                        </div>
                        <div id="license-badge" class="license-badge" style="display:none;">
                        </div>
                    </div>
                </div>
                
                <div id="license-actions" class="license-actions" style="display:none;">
                    <button id="btn-pause" class="btn btn-pause" onclick="pauseLicense()">‚è∏Ô∏è Pause License</button>
                    <button id="btn-resume" class="btn btn-resume" onclick="resumeLicense()" style="display:none;">‚ñ∂Ô∏è Resume License</button>
                    <button id="btn-extend" class="btn btn-extend" onclick="extendLicense()">‚ûï Extend License</button>
                </div>
            </div>

            <div id="support-tab" class="tab-content">
                <h2 style="margin-bottom: 30px; font-size: 2rem; color: var(--accent);">üí¨ Support & Resources</h2>
                <div class="support-links">
                    <a href="https://rxzbot.com" target="_blank" class="support-link">
                        <span>üåê Official Website</span>
                        <span>‚Üí</span>
                    </a>
                    <a href="https://discord.gg/SHdrgSD2RJ" target="_blank" class="support-link">
                        <span>üí¨ Discord Server</span>
                        <span>‚Üí</span>
                    </a>
                    <a href="https://discord.com/users/rxzwashere" target="_blank" class="support-link">
                        <span>üìß Direct Support DM</span>
                        <span>‚Üí</span>
                    </a>
                    <a href="https://instagram.com/smsk_tarik" target="_blank" class="support-link">
                        <span>üì± Instagram</span>
                        <span>‚Üí</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Particles animation (matching index.html)
        function createParticles(){
            const container = document.getElementById('particles');
            for(let i=0;i<50;i++){
                const p = document.createElement('div');
                p.className = 'particle';
                p.style.left = Math.random()*100 + '%';
                p.style.width = p.style.height = Math.random()*4 + 2 + 'px';
                p.style.animationDelay = Math.random()*10 + 's';
                container.appendChild(p);
            }
        }
        createParticles();
        let currentSelected = null;

        async function loadAccounts(){
            try{
                const res = await fetch('/api/dashboard/accounts');
                if(res.status === 401) return window.location = '/loginuser';
                const accounts = await res.json();
                const container = document.getElementById('accounts-list');
                container.innerHTML = '';
                if(!accounts || accounts.length === 0){
                    container.innerHTML = '<p style="color:var(--muted);">No accounts added yet.</p>';
                    return;
                }
                accounts.forEach((acc, idx) => {
                    const a = document.createElement('a');
                    a.href = '#';
                    a.className = 'account-item';
                    a.textContent = acc;
                    a.addEventListener('click', (e)=>{ e.preventDefault(); selectAccount(acc, a); });
                    container.appendChild(a);
                    if(idx===0 && !currentSelected){
                        // auto-select first
                        selectAccount(acc, a);
                    }
                });
            }catch(e){
                console.error('Failed to load accounts', e);
            }
        }

        async function selectAccount(username, anchorEl){
            currentSelected = username;
            // mark active
            document.querySelectorAll('.account-item').forEach(el=>el.classList.remove('active'));
            if(anchorEl) anchorEl.classList.add('active');
            // show account area
            document.getElementById('empty-state').style.display = 'none';
            document.getElementById('account-area').style.display = '';
            // load profile, xp, license
            try{
                const [profRes, xpRes, licRes] = await Promise.all([
                    fetch('/api/dashboard/profile/' + encodeURIComponent(username)),
                    fetch('/api/dashboard/xp/' + encodeURIComponent(username)),
                    fetch('/api/dashboard/license/' + encodeURIComponent(username))
                ]);

                if(profRes.ok){
                    const profRaw = await profRes.json();
                    // map common Wolvesville API fields to expected names
                    const prof = {
                        id: profRaw.id || profRaw.playerId || null,
                        username: profRaw.username || profRaw.name || username,
                        level: profRaw.level || profRaw.playerLevel || 'N/A',
                        xpTotal: profRaw.totalPlayTimeInMinutes || profRaw.xpTotal || 0,
                        xpUntilNextLevel: profRaw.xpUntilNextLevel || null,
                        gamesWon: profRaw.totalWinCount || profRaw.totalVillageWinCount || 0,
                        gamesLost: profRaw.totalLoseCount || profRaw.totalVillageLoseCount || 0,
                        friendsCount: profRaw.friendsCount != null ? profRaw.friendsCount : 'N/A',
                        rankedSeasonSkillRating: profRaw.seasonSkill || profRaw.rankedSeasonSkillRating || 'N/A',
                        clan: profRaw.clan || null
                    };
                    document.getElementById('account-username').textContent = prof.username || username;
                    document.getElementById('account-username-2').textContent = prof.username || username;
                    document.getElementById('account-username-3').textContent = prof.username || username;
                    document.getElementById('account-level').textContent = '‚≠ê Level ' + (prof.level || 'N/A');
                    document.getElementById('account-level-2').textContent = '‚≠ê Level ' + (prof.level || 'N/A');
                    document.getElementById('account-level-3').textContent = '‚≠ê Level ' + (prof.level || 'N/A');
                    document.getElementById('player-id').textContent = prof.id || 'N/A';
                    const profTotal = prof.xpTotal ? prof.xpTotal : 0;
                    document.getElementById('xp-total-display').textContent = profTotal.toLocaleString();
                    document.getElementById('xp-total-dup').textContent = profTotal.toLocaleString();
                    if(document.getElementById('xp-total')) document.getElementById('xp-total').textContent = profTotal.toLocaleString();
                    document.getElementById('xp-until').textContent = prof.xpUntilNextLevel ? prof.xpUntilNextLevel.toLocaleString() : 'N/A';
                    document.getElementById('games-won').textContent = prof.gamesWon ? prof.gamesWon.toLocaleString() : 'N/A';
                    document.getElementById('games-lost').textContent = prof.gamesLost ? prof.gamesLost.toLocaleString() : 'N/A';
                    const gw = prof.gamesWon||0; const gl = prof.gamesLost||0;
                    document.getElementById('win-ratio').textContent = (gw+gl)>0?((gw/(gw+gl)*100).toFixed(1)+'%'):'N/A';
                    document.getElementById('friends-count').textContent = prof.friendsCount!=null?prof.friendsCount:'N/A';
                    document.getElementById('total-games').textContent = (gw+gl)>0? (gw+gl).toLocaleString() : 'N/A';
                    document.getElementById('ranked-skill').textContent = prof.rankedSeasonSkillRating?prof.rankedSeasonSkillRating:'N/A';
                    // clan
                    if(prof.clan){
                        document.getElementById('clan-info-container').style.display='block';
                        document.getElementById('clan-none').style.display='none';
                    } else {
                        document.getElementById('clan-info-container').style.display='none';
                        document.getElementById('clan-none').style.display='block';
                    }
                }

                if(xpRes.ok){
                    const xp = await xpRes.json();
                    // XP object: {daily: {}, weekly: {}, monthly: {}}
                    const today = new Date().toISOString().slice(0,10);
                    const week = new Date().toISOString().slice(0,8); // approximate
                    const month = new Date().toISOString().slice(0,7);
                    document.getElementById('xp-daily').textContent = (xp.daily && xp.daily[today])?xp.daily[today].toLocaleString():0;
                    document.getElementById('xp-weekly').textContent = (xp.weekly && xp.weekly[week])?xp.weekly[week].toLocaleString():0;
                    document.getElementById('xp-monthly').textContent = (xp.monthly && xp.monthly[month])?xp.monthly[month].toLocaleString():0;
                    // update total and levels if available
                    const total = Object.values(xp.daily||{}).reduce((a,b)=>a+(b||0),0);
                    document.getElementById('xp-total-display').textContent = total.toLocaleString();
                    document.getElementById('xp-total-dup').textContent = total.toLocaleString();
                    if(document.getElementById('xp-total')) document.getElementById('xp-total').textContent = total.toLocaleString();
                    document.getElementById('levels-gained').textContent = Math.floor(total/2000);
                }

                if(licRes.ok){
                    const lic = await licRes.json();
                    const msg = document.getElementById('license-message');
                    const details = document.getElementById('license-details');
                    const badge = document.getElementById('license-badge');
                    const actions = document.getElementById('license-actions');
                    const btnPause = document.getElementById('btn-pause');
                    const btnResume = document.getElementById('btn-resume');
                    if(!lic){
                        msg.textContent = '‚ùå No active license';
                        badge.style.display='none';
                        actions.style.display='none';
                    } else {
                        actions.style.display='flex';
                        if(lic.paused){
                            msg.innerHTML = 'Status: <strong style="color:#ffa500;">‚è∏Ô∏è Paused</strong>';
                            details.textContent = 'Paused on: ' + (lic.paused_at || 'N/A') + ' ‚Äî Days remaining: ' + (lic.remaining_days != null ? lic.remaining_days : 'N/A');
                            badge.style.display='inline-block'; badge.className='license-badge paused'; badge.textContent='‚è∏Ô∏è Paused';
                            btnPause.style.display='none'; btnResume.style.display='inline-block';
                        } else {
                            msg.innerHTML = 'Expires: <strong>' + (lic.expires || 'N/A') + '</strong>';
                            details.textContent = '';
                            badge.style.display='inline-block'; badge.className='license-badge active'; badge.textContent='‚úì Active';
                            btnPause.style.display='inline-block'; btnResume.style.display='none';
                        }
                    }
                } else {
                    // HTTP error
                    document.getElementById('license-message').textContent = 'Unable to load license info';
                    document.getElementById('license-actions').style.display='none';
                }
            }catch(e){
                console.error('Failed to load account data', e);
            }
        }

        // initial load
        loadAccounts();
        
        function switchTab(tabName, el) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            // Show selected tab
            const target = document.getElementById(tabName + '-tab');
            if(target) target.classList.add('active');
            if(el) el.classList.add('active');
        }
        
        async function pauseLicense() {
            if (!confirm('‚è∏Ô∏è Are you sure you want to pause your license? You can resume it anytime.')) {
                return;
            }
            
            try {
                const response = await fetch('/api/license/pause', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username: currentSelected })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('‚úÖ License paused successfully!');
                    location.reload();
                } else {
                    alert('‚ùå Error: ' + data.error);
                }
            } catch (error) {
                alert('‚ùå An error occurred. Please try again.');
            }
        }
        
        async function resumeLicense() {
            if (!confirm('‚ñ∂Ô∏è Resume your license?')) {
                return;
            }
            
            try {
                const response = await fetch('/api/license/resume', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username: currentSelected })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('‚úÖ License resumed! New expiry: ' + data.new_expiry);
                    location.reload();
                } else {
                    alert('‚ùå Error: ' + data.error);
                }
            } catch (error) {
                alert('‚ùå An error occurred. Please try again.');
            }
        }
        
        async function extendLicense() {
            try {
                const response = await fetch('/api/license/extend', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username: currentSelected })
                });
                
                const data = await response.json();
                
                if (data.success && data.redirect) {
                    window.location.href = data.redirect;
                } else {
                    alert('‚ùå Error: ' + data.error);
                }
            } catch (error) {
                alert('‚ùå An error occurred. Please try again.');
            }
        }
    </script>
</body>
</html>